<div class="container mt-5 flashy-form">
  <div
    class="bg-light rounded shadow p-4 border border-2 border-primary-subtle animated-border"
  >
    <div class="d-flex align-items-center mb-4">
      <i class="bi bi-person-badge-fill text-primary fs-3 me-2 neon-icon"></i>
      <h3 class="m-0">{{ isNew ? "Nueva Persona" : "Editar Persona" }}</h3>
    </div>

    <form #personaForm="ngForm" (ngSubmit)="savePersona()">
      <div class="row g-4">
        <!-- DNI -->
        <div class="col-md-4">
          <label for="dni" class="form-label required-field">DNI</label>
          <input
            type="text"
            class="form-control form-control-sm"
            [ngClass]="{'is-invalid': dni.invalid && (dni.dirty || dni.touched)}"
            [(ngModel)]="persona.dni"
            name="dni"
            #dni="ngModel"
            [disabled]="!isNew"
            pattern="[0-9]*"
            (keypress)="onlyNumbers($event)"
            required
          />
          <div class="d-flex mt-1">
            <div class="flex-grow-1">
              <small
                class="error-message"
                *ngIf="dni.invalid && (dni.dirty || dni.touched)"
              >
                Campo obligatorio
              </small>
            </div>
            <div class="text-end">
              <small class="text-danger" *ngIf="showErrorDni">
                Solo se permiten números
              </small>
            </div>
          </div>
        </div>

        <!-- CUIL -->
        <div class="col-md-4">
          <label for="cuil" class="form-label required-field">CUIL</label>
          <div class="d-flex align-items-center">
            <!-- Campo para el prefijo del CUIL -->
            <input
              type="text"
              class="form-control form-control-sm me-1"
              [ngClass]="{'is-invalid': cuilPrefixField.invalid && (cuilPrefixField.dirty || cuilPrefixField.touched)}"
              [(ngModel)]="cuilPrefix"
              name="cuilPrefix"
              #cuilPrefixField="ngModel"
              maxlength="2"
              pattern="[0-9]*"
              (keypress)="onlyNumbers($event)"
              [disabled]="!isNew"
              required
            />

            <!-- Campo para el DNI (automáticamente vinculado) -->
            <input
              type="text"
              class="form-control form-control-sm me-1"
              [value]="persona.dni"
              disabled
            />

            <!-- Campo para el sufijo del CUIL -->
            <input
              type="text"
              class="form-control form-control-sm"
              [ngClass]="{'is-invalid': cuilSuffixField.invalid && (cuilSuffixField.dirty || cuilSuffixField.touched)}"
              [(ngModel)]="cuilSuffix"
              name="cuilSuffix"
              #cuilSuffixField="ngModel"
              maxlength="1"
              pattern="[0-9]*"
              (keypress)="onlyNumbers($event)"
              [disabled]="!isNew"
              required
            />
          </div>
          <div class="d-flex mt-1">
            <div class="flex-grow-1">
              <small
                class="error-message"
                *ngIf="
                  (cuilPrefixField.invalid &&
                    (cuilPrefixField.dirty || cuilPrefixField.touched)) ||
                  (cuilSuffixField.invalid &&
                    (cuilSuffixField.dirty || cuilSuffixField.touched))
                "
              >
                Campo obligatorio
              </small>
            </div>
            <div class="text-end">
              <small class="text-danger" *ngIf="showErrorCuil">
                Solo se permiten números
              </small>
            </div>
          </div>
        </div>

        <!-- Sexo -->
        <div class="col-md-4">
          <label for="sexo" class="form-label required-field">Sexo</label>
          <select
            class="form-select form-select-sm"
            [ngClass]="{'is-invalid': sexo.invalid && (sexo.dirty || sexo.touched)}"
            [(ngModel)]="persona.sexo"
            name="sexo"
            #sexo="ngModel"
            required
          >
            <option value="">Seleccione una opción</option>
            <option value="M">Masculino</option>
            <option value="F">Femenino</option>
          </select>
          <small
            class="error-message"
            *ngIf="sexo.invalid && (sexo.dirty || sexo.touched)"
          >
            Campo obligatorio
          </small>
        </div>

        <!-- Nombre -->
        <div class="col-md-6">
          <label for="nombre" class="form-label required-field">Nombre</label>
          <input
            type="text"
            class="form-control"
            [ngClass]="{'is-invalid': nombre.invalid && (nombre.dirty || nombre.touched)}"
            [(ngModel)]="persona.nombre"
            name="nombre"
            #nombre="ngModel"
            required
          />
          <small
            class="error-message"
            *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)"
          >
            Campo obligatorio
          </small>
        </div>

        <!-- Apellido -->
        <div class="col-md-6">
          <label for="apellido" class="form-label required-field">Apellido</label>
          <input
            type="text"
            class="form-control"
            [ngClass]="{'is-invalid': apellido.invalid && (apellido.dirty || apellido.touched)}"
            [(ngModel)]="persona.apellido"
            name="apellido"
            #apellido="ngModel"
            required
          />
          <small
            class="error-message"
            *ngIf="apellido.invalid && (apellido.dirty || apellido.touched)"
          >
            Campo obligatorio
          </small>
        </div>

        <!-- Domicilio -->
        <div class="col-md-6">
          <label for="domicilio" class="form-label required-field">Domicilio</label>
          <input
            type="text"
            class="form-control"
            [ngClass]="{'is-invalid': domicilio.invalid && (domicilio.dirty || domicilio.touched)}"
            [(ngModel)]="persona.domicilio"
            name="domicilio"
            #domicilio="ngModel"
            required
          />
          <small
            class="error-message"
            *ngIf="domicilio.invalid && (domicilio.dirty || domicilio.touched)"
          >
            Campo obligatorio
          </small>
        </div>

        <!-- Título -->
        <div class="col-md-6">
          <label for="titulo" class="form-label">Título</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="persona.titulo"
            name="titulo"
            #titulo="ngModel"
          />
          <small class="text-muted">Este campo es opcional.</small>
        </div>

        <!-- Teléfono -->
        <div class="col-md-6">
          <label for="telefono" class="form-label required-field">Teléfono</label>
          <input
            type="text"
            class="form-control"
            [ngClass]="{'is-invalid': telefono.invalid && (telefono.dirty || telefono.touched)}"
            [(ngModel)]="persona.telefono"
            name="telefono"
            #telefono="ngModel"
            required
          />
          <small
            class="error-message"
            *ngIf="telefono.invalid && (telefono.dirty || telefono.touched)"
          >
            Campo obligatorio
          </small>
        </div>
      </div>

      <div class="mt-4 text-end">
        <button
          type="submit"
          class="btn btn-outline-primary px-4"
          [disabled]="personaForm.invalid"
        >
          <i class="bi bi-check-circle me-1"></i>
          {{ isNew ? "Crear Persona" : "Guardar Cambios" }}
        </button>
      </div>

      <div
        *ngIf="mensaje"
        class="alert mt-4"
        [ngClass]="{ 'alert-danger': isError, 'alert-success': !isError }"
        role="alert"
      >
        <div class="d-flex justify-content-between align-items-center">
          <span>{{ mensaje }}</span>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            (click)="volver()"
          >
            <i class="bi bi-arrow-left me-1"></i>Volver
          </button>
        </div>
      </div>
    </form>
  </div>
</div>